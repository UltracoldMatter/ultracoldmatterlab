<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Firebase Live Chart</title>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <h2>Sensor5 Live Temperature & Humidity</h2>
  <canvas id="myChart" width="800" height="400"></canvas>

  <script>
    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyATktR2jpo9ghUY0_MqpZh_KP5jrW-6YZE",
      authDomain: "ultracoldmatterlablive.firebaseapp.com",
      databaseURL: "https://ultracoldmatterlablive-default-rtdb.asia-southeast1.firebasedatabase.app/",
      projectId: "ultracoldmatterlablive",
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const ctx = document.getElementById('myChart').getContext('2d');
    const chart = new Chart(ctx, {
      type: 'line',
      data: {
        datasets: [
          {
            label: 'Temperature',
            borderColor: 'red',
            data: [],
          },
          {
            label: 'Humidity',
            borderColor: 'blue',
            borderDash: [5, 5],
            data: [],
          }
        ]
      },
      options: {
        animation: false,
        responsive: true,
        scales: {
          x: {
            type: 'time',
            time: {
              tooltipFormat: 'HH:mm:ss',
              unit: 'minute'
            },
            title: {
              display: true,
              text: 'Time'
            }
          },
          y: {
            title: {
              display: true,
              text: 'Value'
            }
          }
        }
      }
    });

    // Listen to /sensor5/ child_added
    const ref = db.ref('sensors/sensor5');
    ref.on('child_added', (snapshot) => {
      const key = snapshot.key; // timestamp string
      const val = snapshot.val();
      const time = new Date(key);
      if (!isNaN(time)) {
        chart.data.datasets[0].data.push({ x: time, y: val.temperature });
        chart.data.datasets[1].data.push({ x: time, y: val.humidity });
        chart.update();
      }
    });
  </script>
</body>
</html>
