<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Live Sensor Graphs</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <style>
    canvas { margin-bottom: 40px; }
    h2 { margin-top: 50px; }
  </style>
</head>
<body>
  <h1>Live Temperature & Humidity - 6 Sensors</h1>

  <div id="charts"></div>

  <script>
    // Initialize Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyATktR2jpo9ghUY0_MqpZh_KP5jrW-6YZE",
      authDomain: "ultracoldmatterlablive.firebaseapp.com",
      databaseURL: "https://ultracoldmatterlablive-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "ultracoldmatterlablive",
      storageBucket: "ultracoldmatterlablive.appspot.com",
      messagingSenderId: "973389235899",
      appId: "1:973389235899:web:your_app_id" // Replace with your app ID if needed
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const sensors = ['sensor1', 'sensor2', 'sensor3', 'sensor4', 'sensor5', 'sensor6'];
    const charts = {};

    const chartContainer = document.getElementById("charts");

    sensors.forEach(sensor => {
      // Create canvas for each sensor
      const canvas = document.createElement("canvas");
      canvas.id = `${sensor}-chart`;
      chartContainer.appendChild(document.createElement("h2")).innerText = sensor.toUpperCase();
      chartContainer.appendChild(canvas);

      const ctx = canvas.getContext("2d");

      charts[sensor] = new Chart(ctx, {
        type: 'line',
        data: {
          labels: [],
          datasets: [
            {
              label: 'Temperature (Â°C)',
              borderColor: 'red',
              data: [],
              fill: false
            },
            {
              label: 'Humidity (%)',
              borderColor: 'blue',
              borderDash: [5, 5],
              data: [],
              fill: false
            }
          ]
        },
        options: {
          responsive: true,
          scales: {
            x: { type: 'time', time: { unit: 'minute' }, title: { display: true, text: 'Time' }},
            y: { title: { display: true, text: 'Value' } }
          }
        }
      });

      // Firebase listener for each sensor
      db.ref(`sensors/${sensor}`).limitToLast(20).on('value', snapshot => {
        const data = snapshot.val();
        if (!data) return;

        const labels = [];
        const tempData = [];
        const humidData = [];

        Object.keys(data).sort().forEach(ts => {
          labels.push(new Date(ts));
          tempData.push(data[ts].temperature || null);
          humidData.push(data[ts].humidity || null);
        });

        charts[sensor].data.labels = labels;
        charts[sensor].data.datasets[0].data = tempData;
        charts[sensor].data.datasets[1].data = humidData;
        charts[sensor].update();
      });
    });
  </script>
</body>
</html>
